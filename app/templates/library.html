{% extends "layout_logged_in.html" %}
{% block content %}
    <main>
        <a href="dashboard" class="back-link">‚Üê Back to dashboard</a>

        <h2 class="left-margin">My Library</h2>

        <div class="library" id="library">
            {% for pdf_name in pdf_names %}
                <div class="file-card" onClick="openModal('{{ pdf_name }}', '{{ pdf_path }}')"> <!--?file={{ pdf_name }}-->
                    <p>{{ pdf_name }}</p>
                </div>
            {% endfor %}
        </div>

        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <div class="audio-and-title">
                    <h3 id="modal-title"></h3>
                    <audio id="audio" controls>Your browser doesn't support the audio element</audio>
                </div>
                <p id="summary-text"></p>
                
            </div>
        </div>
    
        <script>
            function openModal(pdfName, basePath) {
                console.log(pdfName, basePath)
                fetch(`/get_file_data?pdf_name=${pdfName}&base_path=${basePath}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('modal-title').innerText = data.pdf_name;
                        const audio = document.getElementById('audio');
                        if (data.audio_filename) {
                            audio.src = `/download/${encodeURIComponent(data.audio_filename)}`; // {{ url_for('download', filename=audio_filename) }}
                            audio.style.display = 'block';
                        } else {
                            audio.style.display = 'none';
                        }

                        const summaryText = document.getElementById('summary-text');
                        summaryText.innerHTML = data.summary_text;
                        document.getElementById('modal').style.display = 'block';
                    })
                    .catch(error => console.error('Error fetching file data:', error));
            }
    
            function closeModal() {
                document.getElementById('modal').style.display = 'none';
            }
    
            window.onclick = function(event) {
                if (event.target == document.getElementById('modal')) {
                    closeModal();
                }
            }
        </script>
           
    </main>
{% endblock content %}

